class a extends Error{}a.prototype.name="InvalidTokenError";function d(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,o)=>{let t=o.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function p(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return d(e)}catch{return atob(e)}}function f(r,e){if(typeof r!="string")throw new a("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,t=r.split(".")[o];if(typeof t!="string")throw new a(`Invalid token specified: missing part #${o+1}`);let n;try{n=p(t)}catch(c){throw new a(`Invalid token specified: invalid base64 for part #${o+1} (${c.message})`)}try{return JSON.parse(n)}catch(c){throw new a(`Invalid token specified: invalid json for part #${o+1} (${c.message})`)}}function l(){const r=document.cookie.match(/csrf_token=([^;]+)/);return r?r[1]:null}async function u(r,e){try{console.log("Starting login process...");const o={"Content-Type":"application/json"},t=l();t&&(o["X-CSRF-Token"]=t);const n=await fetch("/api/auth/login",{method:"POST",headers:o,credentials:"include",body:JSON.stringify({username:r,password:e})});if(!n.ok){let s=`Login failed: ${n.statusText}`;try{s=(await n.json()).error||s}catch(i){console.warn("Failed to parse error response:",i)}throw r==="cburnell24"||r==="jkeanffd"?new Error("Development mock JWT not configured. Please set VITE_DEV_MOCK_JWT environment variable."):new Error(s)}return await n.json()}catch(o){throw console.error("Login error:",o),o}}async function g(r){try{console.log("Starting signup process...");const e={"Content-Type":"application/json"},o=l();o&&(e["X-CSRF-Token"]=o);const t=await fetch("/api/auth/signup",{method:"POST",headers:e,credentials:"include",body:JSON.stringify(r)});if(!t.ok)throw new Error(`Signup failed: ${t.statusText}`);return await t.json()}catch(e){throw console.error("Signup error:",e),e}}function h(r){try{return f(r)}catch(e){throw console.error("Token decode error:",e),new Error("Invalid token")}}function k(r,e,o){localStorage.setItem("authToken",r),localStorage.setItem("username",e),localStorage.setItem("organizationID",o)}export{h as decodeToken,u as login,k as setStoredAuth,g as signup};
